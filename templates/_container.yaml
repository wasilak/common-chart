{{- define "container" }}
- name: "{{ include "fullname" $ }}"
  image: "{{ $.Values.image.registry }}/{{ $.Values.image.repository }}{{ if $.Values.image.digest }}@{{ $.Values.image.digest }}{{ else }}:{{ $.Values.image.tag }}{{ end }}"
  imagePullPolicy: "{{ $.Values.image.pullPolicy }}"

  {{- include "ports" $ | indent 2 }}

  {{- include "command" $ | indent 2 }}

  {{- include "args" $ | indent 2 }}

  {{- if $.Values.containerSecurityContext }}
  securityContext:
    {{- toYaml $.Values.containerSecurityContext | nindent 4 }}
  {{- end }}

  {{- include "env_vars" $ | indent 2 }}

  {{- include "volumeMounts" $ | indent 2 }}

  {{- if $.Values.resources }}
  resources:
    {{- toYaml $.Values.resources | nindent 4 }}
  {{- end }}

  {{- if $.Values.startupProbeEnabled }}
  startupProbe:
    {{- toYaml $.Values.startupProbe | nindent 4 }}
  {{- end }}

  {{- if $.Values.livenessProbeEnabled }}
  livenessProbe:
    {{- toYaml $.Values.livenessProbe | nindent 4 }}
  {{- end }}

  {{- if $.Values.readinessProbeEnabled }}
  readinessProbe:
    {{- toYaml $.Values.readinessProbe | nindent 4 }}
  {{- end }}

  {{- if or $.Values.lifecycle.preStop $.Values.lifecycle.postStart }}
  lifecycle:
    {{- if $.Values.lifecycle.preStop }}
    preStop:
      {{- toYaml $.Values.lifecycle.preStop | nindent 6 }}
    {{- end }}
    {{- if $.Values.lifecycle.postStart }}
    postStart:
      {{- toYaml $.Values.lifecycle.postStart | nindent 6 }}
    {{- end }}
  {{- end }}
{{- end -}}
